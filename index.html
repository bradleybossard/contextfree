<html>
	<head>
	  <title>ContextFree.js</title>
		<style>
		  textarea {
        display: none;
      }
      #choose{
        float:right;
      }
		  .background{
        width: 100%;
        background-color: #cacaca;
        position: absolute;
        left: 0px;
        padding-top: 5px;
        border-top: 1px solid #666;
      }
		  .padding {
        padding: 20px;
      }
      #canvas {
        width: 500px;
        height: 500px;
      }
	  </style>
  </head>

<body>
  <canvas id="canvas"></canvas>

  <div class="background">
    <div class="padding">
      <div id="choose"><code>Choose a program:</code><br/>
        <select id="menu" multiple="multiple"></select>
      </div>

      <input type="button" value="Redraw" onclick="drawChoice();"/>
      <pre id="code"></pre>
    </div>
  </div>

  <script src="contextfree.js"></script>
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>		
		
  <script>
  function render(cfdg) {
    var t = new Tokenizer();
    var tokens = t.tokenize(cfdg);

    var c = new Compiler();
    var compiled = c.compile(tokens);

/*
    if( compiled.background ){
      var back = compiled.background;
      var backcolor = hsl2rgb( back.h|.001, back.sat|.01, back.b|1, back.a|1 );
      document.body.style.backgroundColor = backcolor;
    }
*/
/*
    var canvas = document.createElement( "canvas" );
    var container = $("#canvasContainer");
    canvas.width = container.width();
    canvas.height = container.height();
    canvas.id = "theCanvas";
  
    $(container).find("#theCanvas").remove();
    $(container).append( canvas );
*/

    context.clearRect(0, 0, $canvas.width(), $canvas.height());

    var r = Renderer;
    r.render(compiled, 'canvas');
  }

  function loadSelect() {
    $.getJSON('cfdgs-pretty.json', function(data) {
      var $menu = $('#menu');
      $.each(data, function(key, value) {
        $('<option></option>')
          .attr('id', key)
          .html(key)
          .val(value)
          .on('click', function() {
            $('#code').html(value);
            render(value);
          })
          .appendTo(menu);
      });
    });
  }

/*
  var canvas = document.createElement("canvas");
  var container = $("#canvasContainer");
  canvas.width = container.width();
  canvas.height = container.height();
  canvas.id = "theCanvas";
*/
  var $canvas = $('#canvas');
  var context = $canvas[0].getContext('2d');

  //$(container).find("#theCanvas").remove();
  //$(container).append( canvas );

  loadSelect();

	</script>

</body>
</html>
